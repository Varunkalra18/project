<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Extra Details</title>

    <!-- GLOBAL GOOGLE FONT SECTION -->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Lobster&display=swap"
      rel="stylesheet"
    />
    <script
      src="https://kit.fontawesome.com/a076d05399.js"
      crossorigin="anonymous"
    ></script>

    <!-- BOOTSTRAP CDN -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css"
    />
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
      integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
      integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
      crossorigin="anonymous"
    ></script>
    <style>
      body {
        background-color: whitesmoke;
      }
      .head {
        color: #1e3883;
      }
      .mid {
        margin: auto;
        margin-top: 100px;
        padding: 10px;
        height: auto;
        width: 700px;
      }
      .upload {
        margin: auto;
        height: 200px;
        width: 200px;
        background: url("static\image\user-default.jpg");
      }
      .main_div {
        background-color: white;
        padding: 30px 0px;
        height: auto;
        width: 800px;
      }
      input {
        height: 40px;
        width: 400px;
      }
    </style>
  </head>
  <body>
    <fieldset class="mid">
      <center>
        <h1 class="head font-weight-bold">To Know You Better .. !!</h1>
      </center>
      <div class="main_div rounded col-sm-12 px-4 col-md">
        <div class="d-flex flex-column align-items-center">
          <img
            class="upload rounded-circle"
            src="../static//image//user-default.jpg"
            id="profile-image"
            alt="Image not found"
          />
          <button
            type="submit"
            onclick="openFileSelector()"
            class="btn_upload btn btn-primary mt-2 px-4"
          >
            Upload Image
          </button>
        </div>
        <form
          action="/midpagedetails"
          class="d-flex flex-column justify-content-around my-2"
          method="POST"
          onsubmit="return updateProfile(event)"
        >
          <input
            hidden
            type="text"
            id="image-upload-url"
            name="profile-image-url"
          />
          <input
            hidden
            type="file"
            id="image-upload"
            onchange="uploadCloudinary()"
          />
          <table>
            <tr>
              <td>Date of Birth</td>
              <td>
                <input
                  class="form-control my-2"
                  id="dob"
                  name="dob"
                  type="date"
                />
              </td>
            </tr>
            <tr>
              <td>Mobile Number</td>
              <td>
                <input
                  class="form-control my-2"
                  id="mob"
                  name="mob"
                  type="text"
                />
              </td>
            </tr>
            <tr>
              <td>Occupation</td>
              <td>
                <input
                  class="form-control my-2"
                  id="occupation"
                  name="occupation"
                  type="text"
                />
              </td>
            </tr>
          </table>
          <div class="ml-auto">
            <a href="/midpage/skip" class="btn btn-secondary px-4">Skip</a>
            <button type="submit" class="btn btn-success px-4">
              Next<i class="fas fa-arrow-right"></i>
            </button>
          </div>
        </form>
      </div>
    </fieldset>
    <script>
      const uploadCloudinary = async () => {
        const profileImage = document.getElementById("image-upload").files[0];
        console.log("profileImage: ", profileImage);

        const CLOUDINARY_UPLOAD_PRESET = "d5sdp4u8";
        const CLOUDINARY_URL =
          "https://api.cloudinary.com/v1_1/blog-zone/image/upload";

        const formData = new FormData();
        formData.append("file", profileImage);
        formData.append("upload_preset", CLOUDINARY_UPLOAD_PRESET);
        formData.append("cloud_name", "dyw6pifnj");

        const response = await fetch(CLOUDINARY_URL, {
          method: "POST",
          body: formData,
        });
        const final_res = await response.json();
        if (!final_res) {
          error_toast("Error occured while uploading image internally .. !!");
          return false;
        }

        document.getElementById("image-upload-url").value =
          final_res.secure_url;
        document.getElementById("profile-image").src = final_res.secure_url;
      };
      const openFileSelector = () => {
        console.log("calling");
        document.getElementById("image-upload").click();
      };
      const updateProfile = (event) => {
        const image = document.getElementById("image-upload-url");
        const dob = document.getElementById("dob");
        const mobileNum = document.getElementById("mob");
        const occupation = document.getElementById("occupation");
        if (!(image && dob && occupation && mobileNum )) {
          event.preventDefault();
          error_toast("All fields are mandatory .. Either Skip .. !!");
          return false;
        }
        return true ;
      };
    </script>
  </body>
</html>
